(("undefined"!==typeof self?self:this)["webpackChunkharvester_1_8_0_dev"]=("undefined"!==typeof self?self:this)["webpackChunkharvester_1_8_0_dev"]||[]).push([[961],{41961:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ue}});var r=a(9274);const s={key:0,class:"upgrade"},o={class:"upgrade-info mb-10"},n={key:0,class:"repoInfo"},l={class:"row"},d={class:"col span-12"},i=["href"],c={key:0,class:"row mb-5"},p={class:"col span-12"},g={class:"state"},u={key:1,class:"row mb-5"},m={class:"col span-12"},h={class:"state"},v={class:"error ml-5"},f={class:"row mb-5"},b={class:"col span-6"},N={class:"text-muted"},y={class:"col span-6"},E={class:"text-muted"},V={class:"row mb-5"},w={class:"col span-6"},k={class:"text-muted"},R={class:"col span-6"},S={class:"text-muted"},D={class:"row mb-5"},x={class:"col span-6"},P={class:"text-muted"},U={class:"col span-6"},C={class:"text-muted"},A={key:1,class:"text-error mb-20"},B={key:2},I={class:"float-r text-info"},L={class:"text-warning"},M={class:"float-r text-info"},_={key:3,class:"text-warning"},G={class:"footer"},$=["disabled"];function F(e,t,a,F,T,O){const z=(0,r.resolveComponent)("BadgeStateFormatter"),j=(0,r.resolveComponent)("PercentageBar"),H=(0,r.resolveComponent)("ProgressBarList"),J=(0,r.resolveComponent)("v-dropdown"),W=(0,r.resolveDirective)("clean-tooltip");return O.enabled&&O.isShow?((0,r.openBlock)(),(0,r.createElementBlock)("div",s,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(J,{"popper-class":"upgrade-header-dropdown",class:"hand"},{popper:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",o,[O.repoInfo?((0,r.openBlock)(),(0,r.createElementBlock)("div",n,[(0,r.createElementVNode)("div",l,[(0,r.createElementVNode)("div",d,[(0,r.createElementVNode)("a",{href:O.releaseLink,target:"_blank"},(0,r.toDisplayString)(O.upgradeVersion),9,i)])]),O.latestResource?((0,r.openBlock)(),(0,r.createElementBlock)("div",c,[(0,r.createElementVNode)("div",p,[(0,r.createElementVNode)("p",g,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.upgradeStatus"))+": ",1),(0,r.createVNode)(z,{class:"ml-5",row:O.latestResource},null,8,["row"])])])])):(0,r.createCommentVNode)("",!0),O.downloadLogFailReason?((0,r.openBlock)(),(0,r.createElementBlock)("div",u,[(0,r.createElementVNode)("div",m,[(0,r.createElementVNode)("p",h,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.logStatus"))+": ",1),(0,r.createElementVNode)("span",v,(0,r.toDisplayString)(O.downloadLogFailReason),1)])])])):(0,r.createCommentVNode)("",!0),t[3]||(t[3]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1)),(0,r.createElementVNode)("div",f,[(0,r.createElementVNode)("div",b,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.os"))+": ",1),(0,r.createElementVNode)("span",N,(0,r.toDisplayString)(O.repoInfo.release.os),1)]),(0,r.createElementVNode)("div",y,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.productLabel"))+": ",1),(0,r.createElementVNode)("span",E,(0,r.toDisplayString)(O.repoInfo.release.harvester),1)])]),(0,r.createElementVNode)("div",V,[(0,r.createElementVNode)("div",w,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.harvesterChart"))+": ",1),(0,r.createElementVNode)("span",k,(0,r.toDisplayString)(O.repoInfo.release.harvesterChart),1)]),(0,r.createElementVNode)("div",R,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.monitoringChart"))+": ",1),(0,r.createElementVNode)("span",S,(0,r.toDisplayString)(O.repoInfo.release.monitoringChart),1)])]),(0,r.createElementVNode)("div",D,[(0,r.createElementVNode)("div",x,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.kubernetes"))+": ",1),(0,r.createElementVNode)("span",P,(0,r.toDisplayString)(O.repoInfo.release.kubernetes),1)]),(0,r.createElementVNode)("div",U,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("product.rancher"))+": ",1),(0,r.createElementVNode)("span",C,(0,r.toDisplayString)(O.repoInfo.release.rancher),1)])]),t[4]||(t[4]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))])):(0,r.createCommentVNode)("",!0),O.overallMessage?((0,r.openBlock)(),(0,r.createElementBlock)("p",A,(0,r.toDisplayString)(O.overallMessage),1)):(0,r.createCommentVNode)("",!0),O.showImage?((0,r.openBlock)(),(0,r.createElementBlock)("div",B,[(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.upgradeImage")),1),(0,r.createElementVNode)("span",I,(0,r.toDisplayString)(O.imageProgress)+"%",1)]),(0,r.createVNode)(j,{"model-value":O.imageProgress,"preferred-direction":"MORE"},null,8,["model-value"]),(0,r.createElementVNode)("p",L,(0,r.toDisplayString)(O.imageMessage),1),t[5]||(t[5]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))])):(0,r.createCommentVNode)("",!0),(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.createRepository"))+" ",1),(0,r.createElementVNode)("span",M,(0,r.toDisplayString)(O.repoReady.isReady?e.t("harvester.upgradePage.succeeded"):e.t("harvester.upgradePage.pending")),1)]),O.repoReady.message?((0,r.openBlock)(),(0,r.createElementBlock)("p",_,(0,r.toDisplayString)(O.repoReady.message),1)):(0,r.createCommentVNode)("",!0),t[6]||(t[6]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1)),(0,r.createVNode)(H,{title:e.t("harvester.upgradePage.upgradeNode"),percent:O.nodesPercent,list:O.nodesStatus},null,8,["title","percent","list"]),t[7]||(t[7]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1)),(0,r.createVNode)(H,{title:e.t("harvester.upgradePage.upgradeSysService"),percent:O.sysServiceTotal,list:O.sysServiceUpgradeMessage},null,8,["title","percent","list"])]),(0,r.createElementVNode)("div",G,[O.canStartedDownload?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,disabled:T.logDownloading,class:"btn role-primary mr-10",onClick:t[0]||(t[0]=e=>O.downloadLog())},[(0,r.createElementVNode)("i",{class:(0,r.normalizeClass)(["icon mr-10",[T.logDownloading?"icon-spinner icon-spin":"icon-download"]])},null,2),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.downloadLog")),1)],8,$)):(0,r.createCommentVNode)("",!0),O.latestResource.isUpgradeSucceeded?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"btn role-primary",onClick:t[1]||(t[1]=e=>O.ignoreMessage())},(0,r.toDisplayString)(e.t("harvester.upgradePage.dismissMessage")),1)):(0,r.createCommentVNode)("",!0)])])),default:(0,r.withCtx)((()=>[(0,r.renderSlot)(e.$slots,"button-content",{},(()=>[t[2]||(t[2]=(0,r.createElementVNode)("i",{class:"warning icon-fw icon icon-dot-open dot-icon"},null,-1))]),!0)])),_:3})),[[W,{placement:"bottom-left"}]])])):(0,r.createCommentVNode)("",!0)}var T=a(35664),O=a(88339),z=a(2602),j=a(12243),H=a(74562),J=a(65359),W=a(20652),K=a(32766);const Y={class:"bar-list"},q={class:"float-r text-info"},Q={class:"total-bar"},X={class:"bar"},Z={class:"custom-content"},ee={class:"upgrade-node-header"},te={class:"upgrade-node-title"},ae=["onClick"],re={class:"warning"};function se(e,t,a,s,o,n){const l=(0,r.resolveComponent)("PercentageBar"),d=(0,r.resolveComponent)("Collapse");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Y,[(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(a.title)+" ",1),(0,r.createElementVNode)("span",q,(0,r.toDisplayString)(a.percent)+"%",1)]),(0,r.createElementVNode)("div",null,[(0,r.createElementVNode)("div",null,[(0,r.createVNode)(d,{open:o.open,"onUpdate:open":t[1]||(t[1]=e=>o.open=e)},{title:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",Q,[(0,r.createElementVNode)("span",X,[(0,r.createVNode)(l,{"model-value":a.percent,"preferred-direction":"MORE"},null,8,["model-value"])]),(0,r.createElementVNode)("span",{class:"on-off",onClick:t[0]||(t[0]=(...e)=>n.handleSwitch&&n.handleSwitch(...e))},(0,r.toDisplayString)(o.open?e.t("harvester.generic.close"):e.t("harvester.generic.open")),1)])])),default:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",Z,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.list,((t,a)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:a},[(0,r.createElementVNode)("div",ee,[(0,r.createElementVNode)("div",te,[(0,r.createElementVNode)("p",null,(0,r.toDisplayString)(t.name),1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status",{[t.state]:!0}])},(0,r.toDisplayString)(t.state),3)]),n.showResumeButton&&n.resumeUpgradePausedNodeEnabled&&"Node-upgrade paused"===t.state?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,type:"button",class:"btn bg-info btn-sm","data-testid":"add-item",onClick:e=>n.resumeNodeUpgrade(t.name)},(0,r.toDisplayString)(e.t("action.resume")),9,ae)):(0,r.createCommentVNode)("",!0)]),(0,r.createVNode)(l,{"model-value":t.percent,"preferred-direction":"MORE"},null,8,["model-value"]),(0,r.createElementVNode)("p",re,(0,r.toDisplayString)(t.message),1)])))),128))])])),_:1},8,["open"])])])])}var oe=a(57142),ne=a(4364),le={name:"HarvesterUpgradeProgressList",components:{PercentageBar:j.A,Collapse:oe.A},props:{title:{type:String,default:""},percent:{type:Number,default:0},list:{type:Array,default:()=>[]}},async fetch(){await this.$store.dispatch("harvester/findAll",{type:K.rk.UPGRADE})},data(){return{open:!0}},computed:{showResumeButton(){return"Upgrading Node"===this.title},latestUpgradeCR(){return this.$store.getters["harvester/all"](K.rk.UPGRADE).find((e=>e.isLatestUpgrade))},resumeUpgradePausedNodeEnabled(){return this.$store.getters["harvester-common/getFeatureEnabled"]("resumeUpgradePausedNode")}},methods:{handleSwitch(){this.open=!this.open},async resumeNodeUpgrade(e){if(this.latestUpgradeCR&&e)try{const t=this.latestUpgradeCR.metadata.annotations[z.r.NODE_UPGRADE_PAUSE_MAP]||"{}",a=JSON.parse(t);a[`${e}`]="unpause",this.latestUpgradeCR.setAnnotation(z.r.NODE_UPGRADE_PAUSE_MAP,JSON.stringify(a)),await this.latestUpgradeCR.save()}catch(t){return ne.error(`unable to update harvester upgrade CR annotations: ${this.latestUpgradeCR.id}.`,t),!1}}}},de=(a(14666),a(47433));const ie=(0,de.A)(le,[["render",se],["__scopeId","data-v-3b3012fa"]]);var ce=ie,pe={name:"HarvesterUpgradeHeader",components:{PercentageBar:j.A,ProgressBarList:ce,BadgeStateFormatter:H.A},async fetch(){const e={};this.$store.getters["harvester/schemaFor"](K.rk.IMAGE)&&(e.images=this.$store.dispatch("harvester/findAll",{type:K.rk.IMAGE})),this.$store.getters["harvester/schemaFor"](K.rk.UPGRADE)&&(e.upgrades=this.$store.dispatch("harvester/findAll",{type:K.rk.UPGRADE})),this.$store.getters["harvester/schemaFor"](T.NW)&&(e.nodes=this.$store.dispatch("harvester/findAll",{type:T.NW})),this.$store.getters["harvester/schemaFor"](K.rk.UPGRADE_LOG)&&(e.upgradeLogs=this.$store.dispatch("harvester/findAll",{type:K.rk.UPGRADE_LOG})),await(0,O.kR)(e)},data(){return{filename:"",logDownloading:!1}},computed:{...(0,J.L8)(["currentProduct","isVirtualCluster"]),enabled(){return this.isVirtualCluster&&this.currentProduct.name===W.KR},latestResource(){return this.$store.getters["harvester/all"](K.rk.UPGRADE).find((e=>e.isLatestUpgrade))},latestUpgradeLogResource(){const e=`${this.latestResource.id}-upgradelog`;return this.$store.getters["harvester/all"](K.rk.UPGRADE_LOG).find((t=>t.id===e))},downloadLogFailReason(){if(!this.filename){const e=this.latestUpgradeLogResource?.latestArchivesFileName;return this.latestUpgradeLogResource?.downloadArchivesStatus(e)}return this.latestUpgradeLogResource?.downloadArchivesStatus(this.filename)},canStartedDownload(){return this.latestUpgradeLogResource?.canStartedDownload||!1},overallMessage(){return this.latestResource?.overallMessage},upgradeImage(){const e=this.latestResource?.upgradeImage;return this.$store.getters["harvester/all"](K.rk.IMAGE).find((t=>t.id===e))},imageProgress(){return this.upgradeImage?.progress||0},showImage(){return!this.latestResource.isUpgradeSucceeded},imageMessage(){return this.latestResource?.upgradeImageMessage},repoReady(){return this.latestResource.createRepo},isShow(){return this.latestResource&&!this.latestResource.hasReadMessage},nodesStatus(){return this.latestResource?.nodeUpgradeMessage},sysServiceUpgradeMessage(){return this.latestResource?.sysServiceUpgradeMessage},sysServiceTotal(){return this.sysServiceUpgradeMessage?.[0].percent||0},nodesPercent(){return this.latestResource?.nodeTotalPercent||0},repoInfo(){return this.latestResource.repoInfo},releaseLink(){return`https://github.com/harvester/harvester/releases/tag/${this.latestResource?.spec?.version}`},upgradeVersion(){return this.latestResource?.spec?.version}},methods:{ignoreMessage(){this.latestResource.setLabel(z.r.REAY_MESSAGE,"true"),this.latestResource.save()},async generateLogFileName(){const e=await this.latestUpgradeLogResource.doActionGrowl("generate");this.filename=e?.data},waitFileGeneratedReady(){const e=this.latestUpgradeLogResource.id;return new Promise((t=>{let a;const r=setInterval((async()=>{a=await this.$store.dispatch("harvester/find",{type:K.rk.UPGRADE_LOG,id:e,opt:{force:!0}},{root:!0}),a.fileIsReady(this.filename)&&(this.logDownloading=!1,clearInterval(r),t())}),2500)}))},async downloadLog(){this.logDownloading=!0,await this.generateLogFileName(),this.waitFileGeneratedReady().then((()=>{this.downloadLogFailReason||this.latestUpgradeLogResource.downloadLog(this.filename),this.logDownloading=!1}))}}};a(80168),a(54782);const ge=(0,de.A)(pe,[["render",F],["__scopeId","data-v-5745bf0e"]]);var ue=ge},81128:function(e,t,a){"use strict";a.r(t);var r=a(36758),s=a.n(r),o=a(40935),n=a.n(o),l=n()(s());l.push([e.id,".upgrade-header-dropdown .v-popper__arrow-container{display:none}",""]),t["default"]=l},85054:function(e,t,a){"use strict";a.r(t);var r=a(36758),s=a.n(r),o=a(40935),n=a.n(o),l=n()(s());l.push([e.id,"a[data-v-5745bf0e]{float:right;color:var(--link)!important;text-decoration:none}.upgrade[data-v-5745bf0e]{height:100%;min-width:40px;display:flex;align-items:center}.upgrade .dot-icon[data-v-5745bf0e]{font-size:24px;vertical-align:middle;color:#00a483}.upgrade-info[data-v-5745bf0e]{min-width:550px;max-height:90vh;overflow-y:scroll}.upgrade-info .repoInfo .col span[data-v-5745bf0e]{word-break:break-all}.upgrade-info .repoInfo p.state[data-v-5745bf0e]{display:flex;align-items:center}.upgrade-info .error[data-v-5745bf0e]{color:var(--error)}.upgrade-info .float-r[data-v-5745bf0e]{float:right}.upgrade-info p[data-v-5745bf0e]{word-break:break-word;margin-top:5px}.footer[data-v-5745bf0e]{display:flex;justify-content:flex-end}",""]),t["default"]=l},4874:function(e,t,a){"use strict";a.r(t);var r=a(36758),s=a.n(r),o=a(40935),n=a.n(o),l=n()(s());l.push([e.id,".bar-list .float-r[data-v-3b3012fa]{float:right}.bar-list .total-bar[data-v-3b3012fa]{display:flex;-webkit-user-select:none;-moz-user-select:none;user-select:none}.bar-list .total-bar>.bar[data-v-3b3012fa]{width:85%}.bar-list .total-bar .on-off[data-v-3b3012fa]{margin-left:10px;cursor:pointer}.bar-list .custom-content[data-v-3b3012fa]{margin-bottom:14px}.bar-list .custom-content .upgrade-node-title[data-v-3b3012fa]{flex:1 0 80%;margin-right:10px;display:flex;justify-content:space-between}.bar-list .custom-content .upgrade-node-header[data-v-3b3012fa]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.bar-list .custom-content .status[data-v-3b3012fa]{float:right}.bar-list .custom-content .Pending[data-v-3b3012fa],.bar-list .custom-content .Succeeded[data-v-3b3012fa],.bar-list .custom-content .Upgrading[data-v-3b3012fa]{color:var(--success)}.bar-list .custom-content .failed[data-v-3b3012fa]{color:var(--error)}.bar-list .custom-content .warning[data-v-3b3012fa]{color:var(--error);margin-bottom:8px;margin-top:4px}",""]),t["default"]=l},80168:function(e,t,a){var r=a(81128);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var s=a(74825).A;s("391b5cb5",r,!0,{sourceMap:!1,shadowMode:!1})},54782:function(e,t,a){var r=a(85054);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var s=a(74825).A;s("68e9c16a",r,!0,{sourceMap:!1,shadowMode:!1})},14666:function(e,t,a){var r=a(4874);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var s=a(74825).A;s("6b06f2a0",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=harvester-1.8.0-dev.umd.min.961.js.map